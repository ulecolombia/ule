// ============================================
// ULE - ESQUEMA DE BASE DE DATOS
// Sistema de Gestión de Seguridad Social
// ============================================

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// Modelo de Usuario para autenticación
model User {
  id            String    @id @default(cuid())
  email         String    @unique
  emailVerified DateTime? @map("email_verified")
  password      String? // Hash bcrypt (opcional para OAuth)
  name          String // Mantener compatibilidad con NextAuth (nombre completo derivado)

  // Campos de nombre separados (onboarding paso 1)
  primerNombre   String?  @map("primer_nombre")
  segundoNombre  String?  @map("segundo_nombre") // Opcional
  primerApellido String?  @map("primer_apellido")
  segundoApellido String? @map("segundo_apellido")

  image         String? // Para futura implementación de avatares
  role          Role      @default(USER)

  // Información personal
  tipoDocumento   TipoDocumento?
  numeroDocumento String?        @map("numero_documento")
  telefono        String?
  direccion       String?
  ciudad          String?
  departamento    String?

  // Información laboral
  tipoContrato           TipoContrato? @map("tipo_contrato")
  profesion              String?
  actividadEconomica     String?       @map("actividad_economica") // Código CIIU
  ingresoMensualPromedio Decimal?      @map("ingreso_mensual_promedio") @db.Decimal(12, 2)
  numeroContratos        Int?          @default(1) @map("numero_contratos")

  // Seguridad social
  entidadSalud           String?   @map("entidad_salud")
  entidadPension         String?   @map("entidad_pension")
  arl                    String?
  fechaAfiliacionSalud   DateTime? @map("fecha_afiliacion_salud")
  fechaAfiliacionPension DateTime? @map("fecha_afiliacion_pension")
  fechaAfiliacionARL     DateTime? @map("fecha_afiliacion_arl")
  nivelRiesgoARL         Int?      @map("nivel_riesgo_arl") // 1-5

  // Información adicional
  estadoCivil       EstadoCivil? @map("estado_civil")
  personasACargo    Int?         @default(0) @map("personas_a_cargo")
  suscribirNewsletter Boolean    @default(false) @map("suscribir_newsletter")

  // ============================================
  // INFORMACIÓN TRIBUTARIA (FACTURACIÓN ELECTRÓNICA)
  // ============================================
  facturacionElectronicaHabilitada Boolean @default(false) @map("facturacion_electronica_habilitada")
  fechaSolicitudFacturacion        DateTime? @map("fecha_solicitud_facturacion")

  nit                     String?   @map("nit") // NIT o RUT para facturación
  razonSocial             String?   @map("razon_social") // Nombre comercial/Razón social
  regimenTributario       RegimenTributario? @map("regimen_tributario")
  responsableIVA          Boolean   @default(false) @map("responsable_iva")
  autorretenedor          Boolean   @default(false) @map("autorretenedor")
  granContribuyente       Boolean   @default(false) @map("gran_contribuyente")

  // Resolución DIAN para facturación electrónica
  resolucionDIAN          String?   @map("resolucion_dian") // Número de resolución
  prefijoFactura          String?   @map("prefijo_factura") // Ej: "FACT", "INV"
  rangoFacturacionDesde   Int?      @map("rango_facturacion_desde") // Ej: 1
  rangoFacturacionHasta   Int?      @map("rango_facturacion_hasta") // Ej: 5000
  fechaResolucion         DateTime? @map("fecha_resolucion")
  consecutivoActual       Int?      @default(1) @map("consecutivo_actual") // Último número usado

  // Branding para facturas
  logoEmpresaUrl          String?   @map("logo_empresa_url")
  colorPrimario           String?   @map("color_primario") // Hex color para PDFs

  // Información bancaria para facturas
  nombreBanco             String?   @map("nombre_banco")
  tipoCuenta              String?   @map("tipo_cuenta") // Ahorros, Corriente
  numeroCuenta            String?   @map("numero_cuenta")

  // Email específico para facturación (opcional, si difiere del email de cuenta)
  emailFacturacion        String?   @map("email_facturacion")

  // ============================================
  // CUMPLIMIENTO LEGAL - LEY 1581 DE 2012
  // ============================================
  aceptoTerminos          Boolean   @default(false) @map("acepto_terminos")
  fechaAceptoTerminos     DateTime? @map("fecha_acepto_terminos")
  versionTerminos         String?   @map("version_terminos")
  aceptoPolitica          Boolean   @default(false) @map("acepto_politica")
  fechaAceptoPolitica     DateTime? @map("fecha_acepto_politica")
  versionPolitica         String?   @map("version_politica")

  // Control
  perfilCompleto Boolean @default(false) @map("perfil_completo")
  autorizacionPILACompleta Boolean @default(false) @map("autorizacion_pila_completa")

  // Campos de auditoría y seguridad
  deletedAt         DateTime? @map("deleted_at")
  lastLoginAt       DateTime? @map("last_login_at")
  phoneVerified     Boolean   @default(false) @map("phone_verified")
  profilePictureUrl String?   @map("profile_picture_url")

  // ============================================
  // SEGURIDAD DE AUTENTICACIÓN
  // ============================================
  passwordHash            String? // Hash bcrypt de la contraseña
  passwordChangedAt       DateTime? @map("password_changed_at")
  failedLoginAttempts     Int       @default(0) @map("failed_login_attempts")
  accountLockedUntil      DateTime? @map("account_locked_until")
  requirePasswordChange   Boolean   @default(false) @map("require_password_change")

  // Autenticación de dos factores (2FA)
  twoFactorEnabled        Boolean   @default(false) @map("two_factor_enabled")
  twoFactorSecret         String?   @map("two_factor_secret") // Encriptado
  twoFactorBackupCodes    Json?     @map("two_factor_backup_codes") // Array de códigos encriptados
  twoFactorEnabledAt      DateTime? @map("two_factor_enabled_at")

  // Recuperación de contraseña
  passwordResetToken      String?   @unique @map("password_reset_token")
  passwordResetExpires    DateTime? @map("password_reset_expires")
  passwordResetAttempts   Int       @default(0) @map("password_reset_attempts")

  // Relaciones NextAuth
  accounts Account[]
  sessions Session[]

  // Relaciones de seguridad
  sesionesSeguridad       Sesion[]
  intentosLogin           IntentoLogin[]
  eventosSeguridad        EventoSeguridad[]

  // Preferencias de notificaciones
  notificacionesEmail Boolean @default(true) @map("notificaciones_email")
  notificacionesPush  Boolean @default(true) @map("notificaciones_push")
  notificacionesInApp Boolean @default(true) @map("notificaciones_in_app")

  // Relaciones (para futuras fases)
  aportes             Aporte[]
  configuracionPila   ConfiguracionPila?
  autorizacionPILA    AutorizacionPILA?
  facturas            Factura[]
  cuentasCobro        CuentaCobro[]
  serviciosFrecuentes ServicioFrecuente[]
  conversaciones      Conversacion[]
  passwordResetTokens PasswordResetToken[]
  documentos          Documento[]
  recordatorios       Recordatorio[]
  clientes            Cliente[]
  usoIA               UsoIA[]
  analisisTributarios AnalisisTributario[]
  consultasFAQ              ConsultaFAQ[]
  terminosAceptados         TerminosAceptados[]
  exportaciones             Exportacion[]
  exportacionesProgramadas  ExportacionProgramada[]
  eventosCalendario         EventoCalendario[]
  recordatoriosEventos      RecordatorioEvento[]
  calculosGuardados         CalculoGuardado[]
  onboardingProgreso        OnboardingProgreso?
  interaccionesAyuda        InteraccionAyuda[]
  analyticsEventos          AnalyticsEvento[]
  errorLogs                 ErrorLog[]

  // Relaciones de cumplimiento legal y privacidad
  consentimientos           ConsentimientoDatos[]
  solicitudesEliminacion    SolicitudEliminacion[]
  solicitudesPortabilidad   SolicitudPortabilidad[]
  configuracionCookies      ConfiguracionCookies?
  logsPrivacidad            LogPrivacidad[]

  // Relaciones de auditoría y seguridad
  logsAuditoria             LogAuditoria[]
  alertasSeguridad          AlertaSeguridad[]

  // Flags de administración
  isAdmin                   Boolean @default(false) @map("is_admin")
  isSuperAdmin              Boolean @default(false) @map("is_super_admin")

  // Timestamps
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Constraint único compuesto para evitar duplicados
  @@unique([tipoDocumento, numeroDocumento])
  // Índices para optimización de búsquedas
  @@index([email])
  @@index([numeroDocumento])
  @@index([tipoDocumento, numeroDocumento])
  @@index([role])
  @@index([deletedAt])
  @@index([createdAt])
  @@map("users")
}

// Modelo para OAuth providers (preparado para futuro)
model Account {
  id                String  @id @default(cuid())
  userId            String  @map("user_id")
  type              String
  provider          String
  providerAccountId String  @map("provider_account_id")
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@index([userId])
  @@map("accounts")
}

// Modelo para sesiones (si usas database sessions)
model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique @map("session_token")
  userId       String   @map("user_id")
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([expires])
  @@map("sessions")
}

// Modelo para tokens de verificación
model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
  @@map("verification_tokens")
}

// Enum de roles
enum Role {
  USER // Usuario regular
  EMPLOYEE // Empleado de la empresa
  ADMIN // Administrador
}

// Enum de tipos de documento
enum TipoDocumento {
  CC // Cédula de Ciudadanía
  CE // Cédula de Extranjería
  PEP // Permiso Especial de Permanencia
  PASAPORTE // Pasaporte
  NIT // Número de Identificación Tributaria (empresas)
}

// Enum de tipos de contrato
enum TipoContrato {
  OPS // Orden de Prestación de Servicios
  INDEPENDIENTE // Trabajador Independiente
  DIRECTO // Contrato Directo
  TERMINO_FIJO // Contrato a Término Fijo
  TERMINO_INDEFINIDO // Contrato a Término Indefinido
}

// Enum de estado civil
enum EstadoCivil {
  SOLTERO
  CASADO
  UNION_LIBRE
  DIVORCIADO
  VIUDO
}

// ============================================
// SISTEMA DE LOCKS DISTRIBUIDOS
// Para prevenir ejecuciones concurrentes de cron jobs
// ============================================

model CronLock {
  id        String   @id
  createdAt DateTime @default(now()) @map("created_at")
  expiresAt DateTime @map("expires_at")

  @@index([expiresAt])
  @@map("cron_locks")
}

// ============================================
// MODELOS PARA FASE 2: LIQUIDACIÓN DE PILA
// ============================================

/// Modelo principal de aportes a seguridad social (PILA)
/// Registra cada periodo de liquidación con sus valores calculados
model Aporte {
  id     String @id @default(cuid())
  userId String @map("user_id")
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Período de cotización
  mes     Int    // 1-12
  anio    Int    // 2025, 2026, etc.
  periodo String // "Enero 2025" para display

  // Valores de cálculo
  ingresoBase Decimal @map("ingreso_base") @db.Decimal(12, 2) // Ingreso mensual reportado
  ibc         Decimal @db.Decimal(12, 2) // Ingreso Base de Cotización calculado

  // Aportes individuales
  salud   Decimal @db.Decimal(12, 2) // 12.5% del IBC
  pension Decimal @db.Decimal(12, 2) // 16% del IBC
  arl     Decimal @db.Decimal(12, 2) // Según nivel de riesgo

  // Total y estado
  total  Decimal       @db.Decimal(12, 2) // Suma de salud + pensión + ARL
  estado EstadoAporte @default(PENDIENTE)

  // Fechas importantes
  fechaLimite DateTime  @map("fecha_limite") // Generalmente día 10 del mes siguiente
  fechaPago   DateTime? @map("fecha_pago")

  // Comprobante
  comprobantePDF    String? @map("comprobante_pdf") // Ruta al archivo PDF del comprobante
  numeroComprobante String? @map("numero_comprobante") // Número de comprobante de pago

  // Relaciones
  recordatorios Recordatorio[]

  // Auditoría
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@unique([userId, mes, anio]) // Un aporte por usuario por período
  @@index([userId, estado])
  @@index([fechaLimite])
  @@index([userId, estado, fechaLimite]) // Para queries de recordatorios (aportes pendientes próximos a vencer)
  @@index([userId, anio, mes]) // Para histórico ordenado por año/mes
  @@index([estado, fechaLimite]) // Para cron jobs (buscar todos los pendientes por vencer globalmente)
  @@map("aportes")
}

/// Configuración personalizada de PILA por usuario
/// Almacena los porcentajes y valores base para cálculos
model ConfiguracionPila {
  id     String @id @default(cuid())
  userId String @unique @map("user_id")
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Valores de referencia
  salarioMinimo Decimal @default(1423500) @map("salario_minimo") @db.Decimal(12, 2) // SMMLV 2025

  // Porcentajes de cotización (pueden variar según normativa)
  porcentajeSalud   Decimal @default(12.5) @map("porcentaje_salud") @db.Decimal(5, 3) // 12.5%
  porcentajePension Decimal @default(16.0) @map("porcentaje_pension") @db.Decimal(5, 3) // 16%

  // ARL según nivel de riesgo
  nivelRiesgoARL NivelRiesgoARL @default(I) @map("nivel_riesgo_arl")
  porcentajeARL  Decimal        @default(0.522) @map("porcentaje_arl") @db.Decimal(5, 3) // Nivel I por defecto

  // Recordatorios
  diasAnticipacionRecordatorio Int     @default(5) @map("dias_anticipacion_recordatorio") // Recordar 5 días antes
  recordatoriosActivos         Boolean @default(true) @map("recordatorios_activos")

  // Auditoría
  ultimaActualizacion DateTime @default(now()) @map("ultima_actualizacion")
  createdAt           DateTime @default(now()) @map("created_at")
  updatedAt           DateTime @updatedAt @map("updated_at")

  @@map("configuracion_pila")
}

// ============================================
// MODELO PARA AUTORIZACIÓN DE GESTIÓN PILA
// Cumplimiento Ley 1581 de 2012
// ============================================

/// Modelo de autorización para gestión de PILA
/// Registra el consentimiento expreso del usuario para:
/// - Gestionar liquidación y pago de aportes
/// - Crear registro como aportante
/// - Consultar información de aportes
/// - Compartir datos con operadores autorizados
model AutorizacionPILA {
  id                    String   @id @default(cuid())
  userId                String   @unique @map("user_id")
  user                  User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Autorizaciones específicas (todas obligatorias)
  autorizaGestionPILA       Boolean  @default(false) @map("autoriza_gestion_pila")
  autorizaCrearAportante    Boolean  @default(false) @map("autoriza_crear_aportante")
  autorizaConsultarInfo     Boolean  @default(false) @map("autoriza_consultar_info")
  autorizaCompartirDatos    Boolean  @default(false) @map("autoriza_compartir_datos")

  // Confirmación final
  aceptaTodo                Boolean  @default(false) @map("acepta_todo")

  // Metadatos de auditoría
  versionTerminos       String   @default("1.0") @map("version_terminos")
  ipAddress             String?  @map("ip_address")
  userAgent             String?  @map("user_agent") @db.Text
  fechaAutorizacion     DateTime @default(now()) @map("fecha_autorizacion")

  // Hash de integridad (SHA-256 de las autorizaciones)
  hashIntegridad        String?  @map("hash_integridad")

  // Para futuras actualizaciones de términos
  actualizaciones       AutorizacionPILAHistorial[]

  createdAt             DateTime @default(now()) @map("created_at")
  updatedAt             DateTime @updatedAt @map("updated_at")

  @@index([userId])
  @@index([fechaAutorizacion])
  @@map("autorizaciones_pila")
}

/// Historial de actualizaciones de autorización PILA
/// Para cuando los términos cambien y el usuario deba re-autorizar
model AutorizacionPILAHistorial {
  id                    String   @id @default(cuid())
  autorizacionId        String   @map("autorizacion_id")
  autorizacion          AutorizacionPILA @relation(fields: [autorizacionId], references: [id], onDelete: Cascade)

  versionAnterior       String   @map("version_anterior")
  versionNueva          String   @map("version_nueva")
  cambiosAceptados      Json     @map("cambios_aceptados")
  ipAddress             String?  @map("ip_address")
  userAgent             String?  @map("user_agent") @db.Text
  fechaActualizacion    DateTime @default(now()) @map("fecha_actualizacion")

  @@index([autorizacionId])
  @@index([fechaActualizacion])
  @@map("autorizaciones_pila_historial")
}

/// Estados posibles de un aporte
enum EstadoAporte {
  PENDIENTE // Aporte liquidado pero no pagado
  PAGADO    // Aporte pagado exitosamente
  VENCIDO   // Aporte no pagado después de fecha límite
  CANCELADO // Aporte cancelado
}

/// Niveles de riesgo ARL (Administradora de Riesgos Laborales)
enum NivelRiesgoARL {
  I  // 0.522% - Riesgo mínimo
  II // 1.044% - Riesgo bajo
  III // 2.436% - Riesgo medio
  IV // 4.350% - Riesgo alto
  V  // 6.960% - Riesgo máximo
}

// ============================================
// MODELOS PARA FACTURACIÓN ELECTRÓNICA
// Normativa DIAN Colombia
// ============================================

/// Modelo de Clientes para Facturación
model Cliente {
  id     String @id @default(cuid())
  userId String @map("user_id")

  // Información básica
  nombre          String
  tipoDocumento   TipoDocumentoCliente @map("tipo_documento")
  numeroDocumento String               @map("numero_documento")
  email           String?
  telefono        String?
  direccion       String?
  ciudad          String?
  departamento    String?

  // Información fiscal (opcional, para empresas)
  razonSocial           String?            @map("razon_social") // Si es empresa
  nombreComercial       String?            @map("nombre_comercial")
  regimenTributario     RegimenTributario? @map("regimen_tributario")
  responsabilidadFiscal String?            @map("responsabilidad_fiscal") // Ej: "IVA", "Retefuente", etc.

  // Metadata
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relaciones
  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  facturas     Factura[]
  cuentasCobro CuentaCobro[]

  @@unique([userId, numeroDocumento]) // Un usuario no puede tener clientes con mismo documento
  @@index([userId])
  @@index([numeroDocumento])
  @@map("clientes")
}

/// Modelo principal de Facturas Electrónicas
model Factura {
  id        String @id @default(cuid())
  userId    String @map("user_id")
  clienteId String @map("cliente_id")

  // Información de la factura
  numeroFactura    String    @map("numero_factura") // Número consecutivo (ej: "FACT-001")
  prefijo          String? // Prefijo autorizado por DIAN (ej: "SETT")
  fecha            DateTime  @default(now())
  fechaVencimiento DateTime? @map("fecha_vencimiento") // Fecha de vencimiento del pago
  metodoPago       String? @map("metodo_pago") // Método de pago (EFECTIVO, TRANSFERENCIA, etc.)

  // Información del cliente (desnormalizada para histórico)
  clienteNombre    String  @map("cliente_nombre")
  clienteDocumento String  @map("cliente_documento")
  clienteEmail     String? @map("cliente_email")
  clienteTelefono  String? @map("cliente_telefono")
  clienteDireccion String? @map("cliente_direccion")
  clienteCiudad    String? @map("cliente_ciudad")

  // Items de la factura (JSON)
  conceptos Json // Array de objetos: [{ descripcion, cantidad, valorUnitario, iva, descuento, total }]

  // Totales
  subtotal        Decimal @db.Decimal(12, 2) // Suma de items sin IVA
  totalDescuentos Decimal @default(0) @map("total_descuentos") @db.Decimal(12, 2)
  totalIva        Decimal @map("total_iva") @db.Decimal(12, 2) // Total IVA
  totalImpuestos  Decimal @default(0) @map("total_impuestos") @db.Decimal(12, 2) // Otros impuestos (si aplica)
  total           Decimal @db.Decimal(12, 2) // Total a pagar

  // Estado de la factura
  estado EstadoFactura @default(BORRADOR)

  // Información DIAN (factura electrónica)
  cufe   String? @unique // Código Único de Factura Electrónica
  cude   String? // Código Único de Documento Electrónico (si aplica)
  qrCode String? @map("qr_code") // URL o data del código QR

  // Archivos generados
  pdfUrl String? @map("pdf_url") // URL del PDF generado
  xmlUrl String? @map("xml_url") // URL del XML para DIAN

  // Notas y observaciones
  notas        String? @db.Text
  terminosPago String? @map("terminos_pago") // Ej: "Pago inmediato", "30 días", etc.

  // Metadata
  fechaEmision    DateTime? @map("fecha_emision") // Fecha en que se emitió (pasó de borrador a emitida)
  fechaAnulacion  DateTime? @map("fecha_anulacion") // Fecha en que se anuló (si aplica)
  motivoAnulacion String?   @map("motivo_anulacion") @db.Text

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relaciones
  user    User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  cliente Cliente        @relation(fields: [clienteId], references: [id], onDelete: Restrict)
  envios  EnvioFactura[]

  @@unique([userId, numeroFactura]) // Número de factura único por usuario
  @@index([userId])
  @@index([clienteId])
  @@index([estado])
  @@index([fecha])
  @@index([cufe])
  @@map("facturas")
}

/// Modelo para tracking de envíos de facturas por email
model EnvioFactura {
  id        String @id @default(cuid())
  facturaId String @map("factura_id")

  // Información del envío
  destinatario String // Email destinatario
  cc           String? // Emails en copia (separados por coma)
  asunto       String
  mensaje      String? @db.Text

  // Adjuntos enviados
  adjuntoPdf Boolean @default(true) @map("adjunto_pdf")
  adjuntoXml Boolean @default(true) @map("adjunto_xml")

  // Estado del envío
  exitoso Boolean @default(false)
  error   String? @db.Text

  // Metadata
  fechaEnvio DateTime @default(now()) @map("fecha_envio")

  // Relaciones
  factura Factura @relation(fields: [facturaId], references: [id], onDelete: Cascade)

  @@index([facturaId])
  @@index([fechaEnvio])
  @@map("envios_facturas")
}

/// Tipos de documento para clientes (DIAN Colombia)
enum TipoDocumentoCliente {
  CC        // Cédula de Ciudadanía
  CE        // Cédula de Extranjería
  NIT       // Número de Identificación Tributaria (empresas)
  PASAPORTE // Pasaporte
  TI        // Tarjeta de Identidad
  RC        // Registro Civil
  DIE       // Documento de Identificación Extranjero
}

/// Regímenes tributarios Colombia (personas naturales)
enum RegimenTributario {
  SIMPLE        // Régimen Simple de Tributación
  ORDINARIO     // Régimen Ordinario (Común)
  ESPECIAL      // Régimen Especial (casos específicos)
  NO_DECLARANTE // No declarante de renta
}

/// Estados de factura electrónica
enum EstadoFactura {
  BORRADOR  // Guardada pero no emitida
  EMITIDA   // Emitida y enviada a DIAN
  PAGADA    // Factura pagada por el cliente
  VENCIDA   // Factura vencida sin pago
  ANULADA   // Factura anulada
  RECHAZADA // Rechazada por DIAN
}

// ============================================
// MODELO PARA CUENTAS DE COBRO
// Para personas naturales no responsables de IVA
// ============================================

/// Estados de cuenta de cobro
enum EstadoCuentaCobro {
  BORRADOR  // Guardada pero no emitida
  EMITIDA   // Emitida y lista para enviar
  ENVIADA   // Enviada al cliente por email
  PAGADA    // Cuenta pagada
  VENCIDA   // Cuenta vencida sin pago
  ANULADA   // Cuenta anulada
}

/// Modelo para cuentas de cobro de personas naturales
model CuentaCobro {
  id        String @id @default(cuid())
  userId    String @map("user_id")
  clienteId String @map("cliente_id")

  // Información de la cuenta de cobro
  numeroCuenta     String   @map("numero_cuenta") // Consecutivo (ej: "CC-001")
  fecha            DateTime @default(now())
  fechaVencimiento DateTime? @map("fecha_vencimiento") // Fecha límite de pago

  // Información del emisor (persona natural - desnormalizada para histórico)
  emisorNombre       String  @map("emisor_nombre")
  emisorDocumento    String  @map("emisor_documento") // Cédula
  emisorTipoDoc      String  @default("CC") @map("emisor_tipo_doc")
  emisorEmail        String? @map("emisor_email")
  emisorTelefono     String? @map("emisor_telefono")
  emisorDireccion    String? @map("emisor_direccion")
  emisorCiudad       String? @map("emisor_ciudad")
  emisorBanco        String? @map("emisor_banco")
  emisorTipoCuenta   String? @map("emisor_tipo_cuenta") // Ahorros, Corriente
  emisorNumeroCuenta String? @map("emisor_numero_cuenta")

  // Información del cliente (a quien se cobra - desnormalizada para histórico)
  clienteNombre    String  @map("cliente_nombre")
  clienteDocumento String  @map("cliente_documento") // NIT o CC
  clienteTipoDoc   String  @default("NIT") @map("cliente_tipo_doc")
  clienteEmail     String? @map("cliente_email")
  clienteTelefono  String? @map("cliente_telefono")
  clienteDireccion String? @map("cliente_direccion")
  clienteCiudad    String? @map("cliente_ciudad")

  // Conceptos/Items de la cuenta (JSON)
  conceptos Json // Array: [{ descripcion, cantidad, valorUnitario, total }]

  // Totales (simple, sin IVA)
  subtotal Decimal @db.Decimal(12, 2) // Suma de items
  total    Decimal @db.Decimal(12, 2) // Total a cobrar (igual a subtotal)

  // Estado
  estado EstadoCuentaCobro @default(BORRADOR)

  // Archivo generado
  pdfUrl String? @map("pdf_url") // URL del PDF generado

  // Notas y observaciones
  notas            String? @db.Text
  conceptoServicio String? @map("concepto_servicio") // Descripción general del servicio

  // Declaración de no responsable de IVA
  declaracionNoIVA Boolean @default(true) @map("declaracion_no_iva")

  // Metadata
  fechaEmision   DateTime? @map("fecha_emision")
  fechaAnulacion DateTime? @map("fecha_anulacion")
  motivoAnulacion String?  @map("motivo_anulacion") @db.Text

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relaciones
  user    User                 @relation(fields: [userId], references: [id], onDelete: Cascade)
  cliente Cliente              @relation(fields: [clienteId], references: [id], onDelete: Restrict)
  envios  EnvioCuentaCobro[]

  @@unique([userId, numeroCuenta]) // Número único por usuario
  @@index([userId])
  @@index([clienteId])
  @@index([estado])
  @@index([fecha])
  @@map("cuentas_cobro")
}

/// Modelo para tracking de envíos de cuentas de cobro por email
model EnvioCuentaCobro {
  id            String @id @default(cuid())
  cuentaCobroId String @map("cuenta_cobro_id")

  // Información del envío
  destinatario String  // Email destinatario
  cc           String? // Emails en copia
  asunto       String
  mensaje      String? @db.Text

  // Estado del envío
  estado    String    @default("ENVIADO") // ENVIADO, ENTREGADO, FALLIDO
  fechaEnvio DateTime @default(now()) @map("fecha_envio")
  error      String?  @db.Text // Error si falló

  createdAt DateTime @default(now()) @map("created_at")

  // Relación
  cuentaCobro CuentaCobro @relation(fields: [cuentaCobroId], references: [id], onDelete: Cascade)

  @@index([cuentaCobroId])
  @@map("envios_cuenta_cobro")
}

// ============================================
// MODELO PARA SERVICIOS FRECUENTES
// Optimización de facturación - pre-cargar servicios comunes
// ============================================

/// Modelo para servicios frecuentes del usuario (optimización de facturación)
/// Permite pre-cargar servicios comunes para agilizar la creación de facturas
model ServicioFrecuente {
  id              String   @id @default(cuid())
  userId          String
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Datos del servicio (PASO 4 spec)
  descripcion     String
  valorUnitario   Decimal  @db.Decimal(15, 2)
  unidad          String   @default("UND")  // UND, HORA, DIA, MES, etc.
  aplicaIVA       Boolean  @default(false)
  porcentajeIVA   Int      @default(0)      // 0, 5, 19

  // Tracking y organización
  vecesUtilizado  Int      @default(0)      // Para tracking de frecuencia
  categoria       String?                   // Organización por categorías
  activo          Boolean  @default(true)   // Soft-delete

  // Timestamps
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([userId])
  @@index([userId, activo])  // Query común: servicios activos del usuario
}

// ============================================
// MODELOS PARA FASE 4: ASESORAMIENTO CON IA
// ============================================

/// Modelo para conversaciones con el asistente de IA
model Conversacion {
  id        String    @id @default(cuid())
  userId    String    @map("user_id")
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  titulo    String    @default("Nueva conversación")
  mensajes  Mensaje[]
  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")

  @@index([userId])
  @@index([createdAt])
  @@index([updatedAt])
  @@map("conversaciones")
}

/// Modelo para mensajes individuales en conversaciones de IA
model Mensaje {
  id              String       @id @default(cuid())
  conversacionId  String       @map("conversacion_id")
  conversacion    Conversacion @relation(fields: [conversacionId], references: [id], onDelete: Cascade)
  rol             RolMensaje
  contenido       String       @db.Text
  timestamp       DateTime     @default(now())

  // Metadata de la respuesta IA (opcional)
  tokensUsados    Int?         @map("tokens_usados")
  modelo          String?

  @@index([conversacionId])
  @@index([timestamp])
  @@map("mensajes")
}

/// Enum para roles de mensajes en conversaciones de IA
enum RolMensaje {
  USER      // Mensaje del usuario
  ASSISTANT // Respuesta de la IA
  SYSTEM    // Mensaje del sistema (opcional)
}

// Modelo para tokens de recuperación de contraseña
model PasswordResetToken {
  id        String   @id @default(cuid())
  userId    String   @map("user_id")
  token     String   @unique
  expiresAt DateTime @map("expires_at")
  used      Boolean  @default(false)
  createdAt DateTime @default(now()) @map("created_at")
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([token])
  @@index([userId])
  @@map("password_reset_tokens")
}

// ============================================
// BIBLIOTECA DE ARCHIVOS UNIFICADA
// Centraliza todos los documentos del usuario
// ============================================

/// Modelo unificado de documentos
/// Registra automáticamente comprobantes PILA, facturas emitidas
/// y permite subir documentos adicionales manualmente
model Documento {
  id     String @id @default(cuid())
  userId String @map("user_id")
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Tipo y categoría del documento
  tipo      TipoDocumentoArchivo
  categoria CategoriaDocumento

  // Información del archivo
  nombre           String // Nombre descriptivo para el usuario
  nombreAlmacenado String @map("nombre_almacenado") // Nombre único en storage
  rutaArchivo      String @map("ruta_archivo") // Ruta completa del archivo
  tipoMIME         String @map("tipo_mime") // application/pdf, image/jpeg, etc.
  tamanoBytes      Int    @map("tamano_bytes") // Tamaño en bytes

  // Relaciones con registros automáticos
  aporteId  String?  @unique @map("aporte_id")
  facturaId String?  @unique @map("factura_id")

  // Organización temporal
  periodo String? // "2025-11" para organización por mes/año
  mes     Int? // 1-12
  anio    Int? // 2025, 2026, etc.

  // Etiquetas y búsqueda
  etiquetas   String[] // ["renta", "gastos", "deducible"]
  descripcion String? // Descripción adicional del usuario

  // Control de acceso (para futuras funcionalidades de compartir)
  esPublico     Boolean  @default(false) @map("es_publico")
  compartidoCon String[] @map("compartido_con") // IDs de usuarios con acceso

  // Auditoría
  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")
  deletedAt DateTime? @map("deleted_at") // Soft delete

  @@index([userId, tipo])
  @@index([userId, categoria])
  @@index([userId, anio, mes])
  @@index([userId, periodo])
  @@index([aporteId])
  @@index([facturaId])
  @@map("documentos")
}

/// Tipos de documento para la biblioteca
enum TipoDocumentoArchivo {
  COMPROBANTE_PILA // Generado automáticamente tras pago PILA
  FACTURA_EMITIDA  // Generado automáticamente al emitir factura
  FACTURA_RECIBIDA // Subida manualmente por el usuario (gastos/proveedores)
  CERTIFICADO      // Certificaciones laborales, ingresos, etc.
  CONTRATO         // Contratos laborales o prestación de servicios
  OTRO             // Cualquier otro documento
}

/// Categorías para organización de documentos
enum CategoriaDocumento {
  SEGURIDAD_SOCIAL    // Comprobantes PILA, afiliaciones
  FACTURACION         // Facturas emitidas (ingresos)
  GASTOS              // Facturas de proveedores/gastos deducibles
  INGRESOS            // Otros comprobantes de ingreso
  CONTRATOS           // Contratos laborales o comerciales
  DECLARACION_RENTA   // Documentos para declaración de renta
  CERTIFICACIONES     // Certificados laborales, diplomas
  OTROS               // Sin categoría específica
}

// ============================================
// MODELO PARA SISTEMA DE RECORDATORIOS
// ============================================

/// Modelo de Recordatorios y Notificaciones
/// Almacena notificaciones in-app y tracking de emails
model Recordatorio {
  id            String              @id @default(cuid())
  userId        String              @map("user_id")
  user          User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  aporteId      String?             @map("aporte_id")
  aporte        Aporte?             @relation(fields: [aporteId], references: [id], onDelete: Cascade)
  tipo          TipoRecordatorio
  titulo        String
  mensaje       String              @db.Text
  fechaEnvio    DateTime            @map("fecha_envio")
  enviado       Boolean             @default(false)
  fechaEnviado  DateTime?           @map("fecha_enviado")
  leido         Boolean             @default(false)
  emailEnviado  Boolean             @default(false) @map("email_enviado")
  metadata      Json?
  createdAt     DateTime            @default(now()) @map("created_at")
  updatedAt     DateTime            @updatedAt @map("updated_at")

  @@index([userId, leido])
  @@index([fechaEnvio, enviado])
  @@index([tipo])
  @@index([userId, tipo, leido, fechaEnvio]) // Para NotificacionesBell (IN_APP ordenadas por fecha)
  @@index([tipo, enviado, fechaEnvio]) // Para cron de emails (recordatorios pendientes de enviar)
  @@index([aporteId, tipo]) // Para evitar duplicados al crear recordatorios
  @@map("recordatorios")
}

enum TipoRecordatorio {
  EMAIL
  PUSH
  IN_APP
}

// ============================================
// MODELO PARA TRACKING DE USO DE IA
// ============================================

/// Modelo para tracking de uso y límites de IA
/// Registra estadísticas diarias de uso por usuario
model UsoIA {
  id              String   @id @default(cuid())
  userId          String   @map("user_id")
  fecha           DateTime @default(now())

  // Métricas
  consultasRealizadas    Int      @default(0) @map("consultas_realizadas")
  tokensUsados           Int      @default(0) @map("tokens_usados")
  conversacionesActivas  Int      @default(0) @map("conversaciones_activas")

  // Relación
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, fecha])
  @@index([userId])
  @@index([fecha])
  @@map("uso_ia")
}

// ============================================
// MODELO PARA ANÁLISIS TRIBUTARIO
// ============================================

/// Modelo para historial de análisis tributario
/// Almacena recomendaciones de régimen tributario generadas por IA
model AnalisisTributario {
  id                  String   @id @default(cuid())
  userId              String   @map("user_id")
  regimenRecomendado  String   @map("regimen_recomendado") // SIMPLE, ORDINARIO, INDETERMINADO
  confianza           String   // ALTA, MEDIA, BAJA
  reporteCompleto     Json     @map("reporte_completo") // Reporte completo en JSON
  ingresoAnalizado    Decimal  @map("ingreso_analizado") @db.Decimal(12, 2)

  createdAt           DateTime @default(now()) @map("created_at")

  // Relación
  user                User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([createdAt])
  @@map("analisis_tributarios")
}

// ============================================
// MODELO PARA FAQs (PREGUNTAS FRECUENTES)
// ============================================

/// Modelo de FAQs con categorización y tracking de popularidad
model FAQ {
  id               String          @id @default(cuid())
  categoria        CategoriaFAQ
  pregunta         String
  descripcionCorta String?         @map("descripcion_corta") // Descripción opcional de 1-2 líneas
  tags             String[]        // Tags para búsqueda
  vecesConsultada  Int             @default(0) @map("veces_consultada")
  activa           Boolean         @default(true)
  orden            Int             @default(0) // Orden manual dentro de categoría

  createdAt        DateTime        @default(now()) @map("created_at")
  updatedAt        DateTime        @updatedAt @map("updated_at")

  // Relación con consultas realizadas
  consultas        ConsultaFAQ[]

  @@index([categoria])
  @@index([vecesConsultada])
  @@map("faqs")
}

/// Registro de cuando un usuario consulta una FAQ
model ConsultaFAQ {
  id              String   @id @default(cuid())
  faqId           String   @map("faq_id")
  userId          String   @map("user_id")
  conversacionId  String?  @map("conversacion_id") // Si se creó una conversación
  timestamp       DateTime @default(now())

  // Relaciones
  faq             FAQ      @relation(fields: [faqId], references: [id], onDelete: Cascade)
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([faqId])
  @@index([userId])
  @@index([timestamp])
  @@map("consultas_faq")
}

/// Categorías de FAQs
enum CategoriaFAQ {
  SEGURIDAD_SOCIAL
  FACTURACION_ELECTRONICA
  REGIMEN_TRIBUTARIO
  OBLIGACIONES_CONTABLES
  CONSTITUCION_EMPRESA
  GENERAL
}

// ============================================
// MODELO PARA TÉRMINOS Y CONDICIONES
// ============================================

/// Modelo para registro de aceptación de términos
model TerminosAceptados {
  id              String      @id @default(cuid())
  userId          String      @map("user_id")
  tipoTermino     TipoTermino @map("tipo_termino")
  version         String      // Versión de los términos (ej: "1.0", "2024-11")
  aceptado        Boolean     @default(true)
  ipAddress       String?     @map("ip_address")
  userAgent       String?     @map("user_agent") @db.Text
  fechaAceptacion DateTime    @default(now()) @map("fecha_aceptacion")

  // Relación
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([tipoTermino])
  @@index([fechaAceptacion])
  @@map("terminos_aceptados")
}

/// Enum de tipos de términos
enum TipoTermino {
  ASESORIA_IA              // Términos del servicio de IA
  USO_PLATAFORMA           // Términos generales de uso
  PRIVACIDAD               // Política de privacidad
  LIMITACION_RESPONSABILIDAD // Disclaimer de responsabilidad
}

// ============================================
// SISTEMA DE EXPORTACIÓN DE DATOS
// ============================================

/// Modelo para tracking de exportaciones
model Exportacion {
  id             String   @id @default(cuid())
  userId         String   @map("user_id")
  tipo           TipoExportacion
  formato        String   // excel, csv, pdf, zip
  nombreArchivo  String   @map("nombre_archivo") // Nombre del archivo generado
  urlArchivo     String   @map("url_archivo") // URL pública del archivo
  tamanoBytes    Int      @default(0) @map("tamano_bytes") // Tamaño en bytes
  expiraEn       DateTime @map("expira_en")
  descargado     Boolean  @default(false)
  createdAt      DateTime @default(now()) @map("created_at")

  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([expiraEn])
  @@map("exportaciones")
}

/// Enum de tipos de exportación
enum TipoExportacion {
  PILA
  FACTURACION
  GENERAL
}

/// Enum de frecuencia de exportación programada
enum FrecuenciaExportacion {
  DIARIA
  SEMANAL
  MENSUAL
}

/// Modelo de exportación programada
model ExportacionProgramada {
  id       String @id @default(cuid())
  userId   String @map("user_id")
  nombre   String
  tipo     TipoExportacion
  formato  String // excel, csv, pdf, zip
  frecuencia FrecuenciaExportacion
  filtros  Json   @default("{}")
  activa   Boolean @default(true)

  // Control de ejecución
  ultimaEjecucion  DateTime? @map("ultima_ejecucion")
  proximaEjecucion DateTime  @map("proxima_ejecucion")

  // Opciones
  enviarEmail Boolean @default(true) @map("enviar_email")

  // Relaciones
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Timestamps
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@index([userId])
  @@index([proximaEjecucion])
  @@index([activa])
  @@map("exportaciones_programadas")
}

// ============================================
// SISTEMA DE CALENDARIO TRIBUTARIO
// ============================================

/// Modelo para eventos del calendario tributario
model EventoCalendario {
  id            String                  @id @default(cuid())
  userId        String                  @map("user_id")
  titulo        String
  descripcion   String?                 @db.Text
  fecha         DateTime                // Fecha principal del evento
  fechaFin      DateTime?               @map("fecha_fin") // Para eventos de varios días
  tipo          TipoEventoCalendario
  categoria     CategoriaEventoTributario?

  // Sistema de notificaciones
  notificar     Boolean                 @default(true)
  notificado7   Boolean                 @default(false) // Notificado 7 días antes
  notificado3   Boolean                 @default(false) // Notificado 3 días antes
  notificado1   Boolean                 @default(false) // Notificado 1 día antes

  // Recurrencia
  recurrente    Boolean                 @default(false)
  frecuencia    FrecuenciaRecurrencia?

  // Metadata
  color         String?                 @default("#4472C4")
  urlExterno    String?                 @map("url_externo") // Link a recurso relacionado
  completado    Boolean                 @default(false)

  createdAt     DateTime                @default(now()) @map("created_at")
  updatedAt     DateTime                @updatedAt @map("updated_at")

  // Relaciones
  user          User                    @relation(fields: [userId], references: [id], onDelete: Cascade)
  recordatorios RecordatorioEvento[]

  // Índices básicos
  @@index([userId])
  @@index([fecha])
  @@index([tipo])

  // Índices optimizados para procesarRecordatorios()
  // Mejora: 500ms → 5ms (100x más rápido)
  @@index([notificar, notificado7, fecha]) // Recordatorios 7 días
  @@index([notificar, notificado3, fecha]) // Recordatorios 3 días
  @@index([notificar, notificado1, fecha]) // Recordatorios 1 día

  // Índice compuesto para queries usuario + fecha
  @@index([userId, fecha]) // Eventos de usuario en rango de fechas

  @@map("eventos_calendario")
}

/// Modelo para recordatorios de eventos
model RecordatorioEvento {
  id               String           @id @default(cuid())
  eventoId         String           @map("evento_id")
  userId           String           @map("user_id")

  // Configuración del recordatorio
  diasAntes        Int              @map("dias_antes") // 7, 3, 1
  horaEnvio        String           @default("09:00") @map("hora_envio") // HH:mm

  // Control de envío
  enviado          Boolean          @default(false)
  fechaEnvio       DateTime?        @map("fecha_envio")
  emailEnviado     Boolean          @default(false) @map("email_enviado")
  notifInApp       Boolean          @default(false) @map("notif_in_app")

  // Relaciones
  evento           EventoCalendario @relation(fields: [eventoId], references: [id], onDelete: Cascade)
  user             User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Timestamps
  createdAt        DateTime         @default(now()) @map("created_at")

  @@index([eventoId])
  @@index([userId])
  @@index([enviado])
  @@index([fechaEnvio])
  @@map("recordatorios_eventos")
}

/// Enum de tipos de evento
enum TipoEventoCalendario {
  VENCIMIENTO_PILA        // Pago de seguridad social
  DECLARACION_RENTA       // Declaración de renta
  DECLARACION_IVA         // Declaración de IVA
  DECLARACION_RETEFUENTE  // Retención en la fuente
  ACTUALIZACION_SMMLV     // Actualización salario mínimo
  PAGO_IMPUESTOS          // Pago de impuestos
  RENOVACION_RUT          // Renovación RUT
  EVENTO_PERSONAL         // Evento personalizado del usuario
  OTRO                    // Otros eventos
}

/// Enum de categorías de evento
enum CategoriaEventoTributario {
  TRIBUTARIO
  CONTABLE
  LABORAL
  ADMINISTRATIVO
  PERSONAL
}

/// Enum de frecuencia de recurrencia
enum FrecuenciaRecurrencia {
  MENSUAL
  BIMESTRAL
  TRIMESTRAL
  CUATRIMESTRAL
  SEMESTRAL
  ANUAL
}

// ============================================
// SISTEMA DE CALCULADORAS TRIBUTARIAS
// ============================================

/// Modelo para historial de cálculos guardados
model CalculoGuardado {
  id              String          @id @default(cuid())
  userId          String          @map("user_id")
  tipoCalculadora TipoCalculadora @map("tipo_calculadora")
  inputs          Json            // Valores ingresados por el usuario
  resultados      Json            // Resultados calculados
  notas           String?         // Notas opcionales del usuario

  createdAt       DateTime        @default(now()) @map("created_at")

  // Relación
  user            User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([tipoCalculadora])
  @@index([createdAt])
  @@map("calculos_guardados")
}

/// Enum de tipos de calculadora
enum TipoCalculadora {
  RETENCION_FUENTE
  IVA
  PROYECCION_PILA
  SIMULADOR_REGIMEN
  SIMULADOR_PENSIONAL
  CONVERSOR_UVT
}

// ============================================
// SISTEMA DE AYUDA Y ONBOARDING
// ============================================

/// Modelo para tracking de progreso de onboarding
model OnboardingProgreso {
  id                    String   @id @default(cuid())
  userId                String   @unique @map("user_id")

  // Tours guiados completados
  tourDashboardVisto    Boolean  @default(false) @map("tour_dashboard_visto")
  tourPILAVisto         Boolean  @default(false) @map("tour_pila_visto")
  tourFacturacionVisto  Boolean  @default(false) @map("tour_facturacion_visto")
  tourAsesoriaVisto     Boolean  @default(false) @map("tour_asesoria_visto")

  // Hitos de onboarding
  perfilCompletado      Boolean  @default(false) @map("perfil_completado")
  entidadesConfiguradas Boolean  @default(false) @map("entidades_configuradas")
  primeraPILA           Boolean  @default(false) @map("primera_pila")
  primeraFactura        Boolean  @default(false) @map("primera_factura")
  primeraConsultaIA     Boolean  @default(false) @map("primera_consulta_ia")

  // Control
  ultimoTourVisto       DateTime? @map("ultimo_tour_visto")

  // Timestamps
  createdAt             DateTime  @default(now()) @map("created_at")
  updatedAt             DateTime  @updatedAt @map("updated_at")

  // Relación
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("onboarding_progreso")
}

/// Modelo para tracking de interacciones con el sistema de ayuda
model InteraccionAyuda {
  id              String   @id @default(cuid())
  userId          String   @map("user_id")
  tipo            TipoInteraccionAyuda
  contenido       String   @db.Text // Descripción de la interacción
  util            Boolean? // Feedback del usuario (¿fue útil?)

  // Timestamp
  createdAt       DateTime @default(now()) @map("created_at")

  // Relación
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([tipo])
  @@index([createdAt])
  @@map("interacciones_ayuda")
}

/// Enum de tipos de interacción con ayuda
enum TipoInteraccionAyuda {
  TOUR_COMPLETADO
  ARTICULO_LEIDO
  VIDEO_VISTO
  FAQ_CONSULTADA
  BUSQUEDA
  WIDGET_USADO
}

// ============================================
// SISTEMA DE ANALYTICS Y MONITOREO
// ============================================

/// Modelo de evento analítico
model AnalyticsEvento {
  id              String           @id @default(cuid())
  userId          String?          @map("user_id") // Opcional para eventos anónimos
  sessionId       String?          @map("session_id") // ID de sesión
  evento          String           // Nombre del evento
  categoria       CategoriaEventoAnalytics
  metadata        Json?            // Datos adicionales del evento

  // Contexto técnico
  userAgent       String?          @map("user_agent") @db.Text
  ip              String?
  pais            String?
  ciudad          String?
  dispositivo     String?          // mobile, desktop, tablet
  navegador       String?

  timestamp       DateTime         @default(now())

  // Relación
  user            User?            @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@index([userId])
  @@index([evento])
  @@index([categoria])
  @@index([timestamp])
  @@index([sessionId])
  @@map("analytics_eventos")
}

/// Categorías de eventos
enum CategoriaEventoAnalytics {
  ONBOARDING      // registro, perfil completado
  PILA            // liquidación, pago
  FACTURACION     // nueva factura, emisión
  ASESORIA        // consulta IA
  EXPORTACION     // descarga de datos
  NAVEGACION      // pageviews
  SISTEMA         // errores, performance
  CALCULADORAS    // uso de calculadoras y simuladores
}

/// Modelo de métricas agregadas (para dashboard rápido)
model MetricaDiaria {
  id                      String   @id @default(cuid())
  fecha                   DateTime @unique

  // Usuarios
  usuariosActivos         Int      @default(0) @map("usuarios_activos")
  nuevosUsuarios          Int      @default(0) @map("nuevos_usuarios")
  usuariosRetenidos       Int      @default(0) @map("usuarios_retenidos")

  // Features
  usosPILA                Int      @default(0) @map("usos_pila")
  usosFacturacion         Int      @default(0) @map("usos_facturacion")
  usosAsesoria            Int      @default(0) @map("usos_asesoria")

  // Conversión
  registrosCompletados    Int      @default(0) @map("registros_completados")
  perfilesCompletados     Int      @default(0) @map("perfiles_completados")
  primerasPILA            Int      @default(0) @map("primeras_pila")
  primerasFacturas        Int      @default(0) @map("primeras_facturas")

  // Engagement
  sesionesPromedio        Float    @default(0) @map("sesiones_promedio")
  duracionPromedioMinutos Float    @default(0) @map("duracion_promedio_minutos")

  createdAt               DateTime @default(now()) @map("created_at")
  updatedAt               DateTime @updatedAt @map("updated_at")

  @@index([fecha])
  @@map("metricas_diarias")
}

/// Modelo de error capturado
model ErrorLog {
  id              String         @id @default(cuid())
  userId          String?        @map("user_id")
  sessionId       String?        @map("session_id")

  // Detalles del error
  mensaje         String         @db.Text
  stack           String?        @db.Text
  tipo            String         // Error, TypeError, etc.
  severidad       SeveridadError

  // Contexto
  url             String?
  componente      String?
  accion          String?
  metadata        Json?

  // Técnico
  navegador       String?
  dispositivo     String?
  userAgent       String?        @db.Text

  // Resolución
  resuelto        Boolean        @default(false)
  fechaResolucion DateTime?      @map("fecha_resolucion")

  timestamp       DateTime       @default(now())

  user            User?          @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@index([userId])
  @@index([severidad])
  @@index([timestamp])
  @@index([resuelto])
  @@map("error_logs")
}

enum SeveridadError {
  INFO
  WARNING
  ERROR
  CRITICAL
}

// ============================================
// SISTEMA DE SEGURIDAD DE AUTENTICACIÓN
// ============================================

/// Modelo para sesiones de usuario con seguimiento de seguridad
/// Rastrea dispositivos, ubicaciones y actividad de sesión
model Sesion {
  id              String   @id @default(cuid())
  userId          String   @map("user_id")

  // Identificación de sesión
  token           String   @unique // Token de sesión único
  activa          Boolean  @default(true)
  esActual        Boolean  @default(false) @map("es_actual") // Marca la sesión actual del usuario

  // Información del dispositivo
  dispositivo     String?  // mobile, desktop, tablet
  navegador       String?  // Chrome, Firefox, Safari, etc.
  sistemaOperativo String? @map("sistema_operativo") // Windows, macOS, iOS, Android, etc.
  userAgent       String   @db.Text @map("user_agent")

  // Geolocalización
  ip              String
  pais            String?
  ciudad          String?

  // Control de actividad
  ultimaActividad DateTime @default(now()) @map("ultima_actividad")
  expiraEn        DateTime @map("expira_en")

  // Auditoría
  createdAt       DateTime @default(now()) @map("created_at")
  cerradaEn       DateTime? @map("cerrada_en")
  revokedAt       DateTime? @map("revoked_at") // Fecha en que se revocó la sesión

  // Relación
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, activa])
  @@index([token])
  @@index([expiraEn])
  @@index([ultimaActividad])
  @@map("sesiones")
}

/// Modelo para tracking de intentos de login
/// Permite detectar ataques de fuerza bruta y credential stuffing
model IntentoLogin {
  id                String   @id @default(cuid())
  userId            String?  @map("user_id") // Null si el usuario no existe
  email             String   // Email usado en el intento

  // Resultado del intento
  exitoso           Boolean
  razonFallo        String?  @map("razon_fallo") // PASSWORD_INCORRECTO, CUENTA_BLOQUEADA, 2FA_FALLIDO, etc.

  // Información del intento
  ip                String
  pais              String?
  ciudad            String?
  userAgent         String   @db.Text @map("user_agent")

  // Detección de amenazas
  bloqueadoPorRateLimit Boolean @default(false) @map("bloqueado_por_rate_limit")
  ipSospechosa          Boolean @default(false) @map("ip_sospechosa")

  // Timestamp
  timestamp         DateTime @default(now())

  // Relación (opcional, puede ser null si el usuario no existe)
  user              User?    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([email, timestamp])
  @@index([userId, timestamp])
  @@index([ip, timestamp])
  @@index([exitoso, timestamp])
  @@map("intentos_login")
}

/// Modelo para auditoría de eventos de seguridad
/// Registra todas las acciones sensibles para cumplimiento legal
model EventoSeguridad {
  id              String                @id @default(cuid())
  userId          String                @map("user_id")

  // Tipo y severidad del evento
  tipo            TipoEventoSeguridad
  severidad       SeveridadEvento

  // Descripción del evento
  descripcion     String                @db.Text
  metadata        Json?                 // Datos adicionales del evento (sin PII sensible)

  // Contexto técnico
  ip              String?
  userAgent       String?               @db.Text @map("user_agent")
  sesionId        String?               @map("sesion_id")

  // Auditoría
  timestamp       DateTime              @default(now())

  // Relación
  user            User                  @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, timestamp])
  @@index([tipo, timestamp])
  @@index([severidad, timestamp])
  @@map("eventos_seguridad")
}

/// Tipos de eventos de seguridad
enum TipoEventoSeguridad {
  // Autenticación
  LOGIN_EXITOSO
  LOGIN_FALLIDO
  LOGIN_BLOQUEADO
  LOGOUT

  // Gestión de cuenta
  REGISTRO_CUENTA
  CAMBIO_PASSWORD
  RECUPERACION_PASSWORD
  PASSWORD_RESET_SOLICITADO
  PASSWORD_RESET_COMPLETADO
  CUENTA_BLOQUEADA
  CUENTA_DESBLOQUEADA

  // 2FA
  ACTIVACION_2FA
  DESACTIVACION_2FA
  TWO_FACTOR_HABILITADO
  TWO_FACTOR_CODIGO_USADO
  LOGIN_2FA_EXITOSO
  LOGIN_2FA_FALLIDO

  // Sesiones
  SESION_INICIADA
  SESION_CERRADA
  SESION_EXPIRADA
  SESION_REVOCADA

  // Datos sensibles
  ACCESO_DATOS_SENSIBLES
  MODIFICACION_DATOS_SENSIBLES
  EXPORTACION_DATOS

  // Amenazas detectadas
  INTENTO_FUERZA_BRUTA
  CREDENTIAL_STUFFING_DETECTADO
  IP_SOSPECHOSA
  ACTIVIDAD_ANOMALA

  // Administrativo
  CAMBIO_PERMISOS
  CAMBIO_CONFIGURACION_SEGURIDAD
}

/// Niveles de severidad para eventos de seguridad
enum SeveridadEvento {
  BAJA      // Eventos informativos normales
  MEDIA     // Eventos que requieren atención
  ALTA      // Eventos de riesgo alto
  CRITICA   // Eventos críticos que requieren acción inmediata
}

// ============================================================================
// ENUMS - CUMPLIMIENTO LEGAL Y PROTECCIÓN DE DATOS (LEY 1581 DE 2012)
// ============================================================================

/// Tipos de consentimiento según Ley 1581 de 2012
enum TipoConsentimiento {
  TERMINOS_CONDICIONES
  POLITICA_PRIVACIDAD
  TRATAMIENTO_DATOS_PERSONALES
  COOKIES_ESENCIALES
  COOKIES_ANALITICAS
  COOKIES_MARKETING
  COOKIES_PERSONALIZACION
  NOTIFICACIONES_EMAIL
  NOTIFICACIONES_PUSH
  COMPARTIR_DATOS_TERCEROS
  MARKETING_DIRECTO
  TRANSFERENCIA_INTERNACIONAL
}

/// Estados de solicitud de eliminación de cuenta
enum EstadoSolicitudEliminacion {
  PENDIENTE            // Solicitud creada, esperando confirmación
  CONFIRMADA           // Usuario confirmó con token
  EN_PERIODO_GRACIA    // 30 días de espera antes de ejecutar
  CANCELADA            // Usuario canceló la solicitud
  EJECUTADA            // Cuenta eliminada exitosamente
  ERROR                // Error durante el proceso
}

/// Estados de solicitud de portabilidad
enum EstadoSolicitudPortabilidad {
  PENDIENTE     // Solicitud en cola
  PROCESANDO    // Generando archivo de exportación
  COMPLETADA    // Exportación lista para descarga
  ERROR         // Error durante la exportación
}

/// Tipos de acciones de privacidad para auditoría
enum AccionPrivacidad {
  CONSENTIMIENTO_OTORGADO
  CONSENTIMIENTO_REVOCADO
  SOLICITUD_EXPORTACION
  EXPORTACION_COMPLETADA
  SOLICITUD_ELIMINACION
  ELIMINACION_CONFIRMADA
  ELIMINACION_CANCELADA
  ELIMINACION_EJECUTADA
  DATOS_ACTUALIZADOS
  DATOS_RECTIFICADOS
  ACCESO_DATOS_PERSONALES
  CONFIGURACION_COOKIES_ACTUALIZADA
}

// ============================================================================
// MODELOS DE CUMPLIMIENTO LEGAL Y PROTECCIÓN DE DATOS
// ============================================================================

/// Registro de consentimientos del usuario
/// Cumple con Art. 9 Ley 1581: "Consentimiento previo, expreso e informado"
model ConsentimientoDatos {
  id          String   @id @default(cuid())
  userId      String   @map("user_id")
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  tipo        TipoConsentimiento
  otorgado    Boolean
  version     String   // Versión del documento aceptado

  // Metadata de auditoría
  ipAddress   String?  @map("ip_address")
  userAgent   String?  @map("user_agent") @db.Text

  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@index([userId])
  @@index([tipo])
  @@index([createdAt])
  @@map("consentimientos_datos")
}

/// Solicitudes de eliminación de cuenta
/// Derecho al Olvido - Art. 15 Ley 1581
model SolicitudEliminacion {
  id                String   @id @default(cuid())
  userId            String   @map("user_id")
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  estado            EstadoSolicitudEliminacion @default(PENDIENTE)

  // Control de proceso
  tokenConfirmacion String?  @unique @map("token_confirmacion")
  fechaSolicitud    DateTime @default(now()) @map("fecha_solicitud")
  fechaConfirmacion DateTime? @map("fecha_confirmacion")
  fechaEjecucion    DateTime? @map("fecha_ejecucion")
  fechaCancelacion  DateTime? @map("fecha_cancelacion")

  // Metadata
  motivoEliminacion String?  @db.Text @map("motivo_eliminacion")
  ipSolicitud       String?  @map("ip_solicitud")

  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")

  @@index([userId])
  @@index([estado])
  @@index([fechaSolicitud])
  @@map("solicitudes_eliminacion")
}

/// Solicitudes de exportación de datos
/// Derecho a la Portabilidad
model SolicitudPortabilidad {
  id             String   @id @default(cuid())
  userId         String   @map("user_id")
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  estado         EstadoSolicitudPortabilidad @default(PENDIENTE)

  // Archivo generado
  archivoUrl     String?  @map("archivo_url")
  archivoExpira  DateTime? @map("archivo_expira") // 7 días desde generación

  // Metadata
  ipSolicitud    String?  @map("ip_solicitud")
  tamanoBytes    Int?     @map("tamano_bytes")

  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")

  @@index([userId])
  @@index([estado])
  @@index([createdAt])
  @@map("solicitudes_portabilidad")
}

/// Configuración de cookies del usuario
/// Cumplimiento con normativa de cookies
model ConfiguracionCookies {
  id                    String   @id @default(cuid())
  userId                String   @unique @map("user_id")
  user                  User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Preferencias
  cookiesEsenciales     Boolean  @default(true) @map("cookies_esenciales")
  cookiesAnaliticas     Boolean  @default(false) @map("cookies_analiticas")
  cookiesMarketing      Boolean  @default(false) @map("cookies_marketing")
  cookiesPersonalizacion Boolean @default(false) @map("cookies_personalizacion")

  // Metadata
  ipAceptacion          String?  @map("ip_aceptacion")
  fechaAceptacion       DateTime? @map("fecha_aceptacion")

  createdAt             DateTime @default(now()) @map("created_at")
  updatedAt             DateTime @updatedAt @map("updated_at")

  @@index([userId])
  @@map("configuracion_cookies")
}

/// Log de acciones de privacidad
/// Auditoría completa para demostrar cumplimiento
model LogPrivacidad {
  id          String   @id @default(cuid())
  userId      String   @map("user_id")
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  accion      AccionPrivacidad
  descripcion String?  @db.Text

  // Metadata
  ipAddress   String?  @map("ip_address")
  userAgent   String?  @map("user_agent") @db.Text
  metadata    Json?    // Datos adicionales contextuales

  createdAt   DateTime @default(now()) @map("created_at")

  @@index([userId])
  @@index([accion])
  @@index([createdAt])
  @@map("logs_privacidad")
}

// ============================================================================
// SISTEMA DE AUDITORÍA Y TRAZABILIDAD COMPLETO
// ============================================================================

/// Log de auditoría - Registro inmutable de todas las acciones críticas
model LogAuditoria {
  id              String              @id @default(cuid())

  // Usuario que realiza la acción
  userId          String?             @map("user_id") // Null para acciones del sistema
  userEmail       String?             @map("user_email") // Duplicado para búsquedas rápidas
  userName        String?             @map("user_name") // Duplicado para reportes

  // Acción realizada
  accion          AccionAuditoria
  recurso         String?             // Recurso afectado (ej: "factura:123")

  // Resultado
  exitoso         Boolean             @default(true)
  codigoError     String?             @map("codigo_error")
  mensajeError    String?             @db.Text @map("mensaje_error")

  // Detalles técnicos (JSON para flexibilidad)
  detalles        Json?               // Datos específicos de la acción
  detallesAntes   Json?               @map("detalles_antes") // Estado anterior (para cambios)
  detallesDespues Json?               @map("detalles_despues") // Estado posterior (para cambios)

  // Contexto técnico
  ip              String              // IPv4 o IPv6
  ipGeo           Json?               @map("ip_geo") // {country, city, lat, lon}
  userAgent       String              @db.Text @map("user_agent")
  dispositivo     String?             // mobile, desktop, tablet
  navegador       String?             // Chrome, Firefox, Safari
  sistemaOperativo String?            @map("sistema_operativo") // Windows, macOS, Linux, iOS, Android

  // Contexto de la petición
  metodoHttp      String?             @map("metodo_http") // GET, POST, PUT, DELETE
  ruta            String?             // /api/facturas/create
  duracionMs      Int?                @map("duracion_ms") // Tiempo de ejecución

  // Seguridad
  nivelRiesgo     NivelRiesgo         @default(BAJO) @map("nivel_riesgo")
  requiereRevision Boolean            @default(false) @map("requiere_revision")
  revisadoPor     String?             @map("revisado_por")
  fechaRevision   DateTime?           @map("fecha_revision")

  // Metadata
  timestamp       DateTime            @default(now())
  sessionId       String?             @map("session_id") // ID de sesión
  requestId       String?             @map("request_id") // ID único de request (para correlación)

  // Contexto de auditoría
  categoria       CategoriaAuditoria  @default(GENERAL)
  tags            String[]            // Para búsquedas y agrupación

  // Relación
  user            User?               @relation(fields: [userId], references: [id], onDelete: SetNull)

  // Índices optimizados para búsquedas comunes
  @@index([userId])
  @@index([userEmail])
  @@index([accion])
  @@index([timestamp])
  @@index([nivelRiesgo])
  @@index([categoria])
  @@index([exitoso])
  @@index([ip])
  @@index([sessionId])
  @@index([requestId])
  @@index([timestamp, userId]) // Búsquedas por usuario y fecha
  @@index([timestamp, accion]) // Búsquedas por acción y fecha
  @@map("logs_auditoria")
}

/// Alertas de seguridad generadas automáticamente
model AlertaSeguridad {
  id              String              @id @default(cuid())

  // Clasificación
  tipo            TipoAlerta
  severidad       SeveridadAlerta

  // Descripción
  titulo          String
  descripcion     String              @db.Text

  // Usuario afectado
  userId          String?             @map("user_id")
  userEmail       String?             @map("user_email")

  // Contexto
  logIds          String[]            @map("log_ids") // IDs de logs relacionados
  metadata        Json                // Datos adicionales

  // Geolocalización
  ip              String?
  ubicacion       String?

  // Estado
  estado          EstadoAlerta        @default(PENDIENTE)

  // Gestión
  asignadoA       String?             @map("asignado_a") // Admin que la gestiona
  fechaAsignacion DateTime?           @map("fecha_asignacion")
  fechaResolucion DateTime?           @map("fecha_resolucion")
  notas           String?             @db.Text
  accionTomada    String?             @db.Text @map("accion_tomada")

  // Notificaciones
  notificado      Boolean             @default(false)
  fechaNotificacion DateTime?         @map("fecha_notificacion")

  // Metadata
  createdAt       DateTime            @default(now()) @map("created_at")
  updatedAt       DateTime            @updatedAt @map("updated_at")

  // Relación
  user            User?               @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@index([userId])
  @@index([tipo])
  @@index([severidad])
  @@index([estado])
  @@index([createdAt])
  @@map("alertas_seguridad")
}

/// Políticas de retención de logs para cumplimiento legal
model PoliticaRetencion {
  id                String              @id @default(cuid())

  // Política
  categoria         CategoriaAuditoria  @unique
  diasRetencion     Int                 @map("dias_retencion") // Días de retención
  descripcion       String              @db.Text

  // Legal
  requisitoLegal    String?             @db.Text @map("requisito_legal") // Ley que lo requiere

  // Metadata
  activa            Boolean             @default(true)
  createdAt         DateTime            @default(now()) @map("created_at")
  updatedAt         DateTime            @updatedAt @map("updated_at")

  @@map("politicas_retencion")
}

// ============================================================================
// ENUMS DE AUDITORÍA
// ============================================================================

enum AccionAuditoria {
  // Autenticación
  LOGIN
  LOGOUT
  LOGIN_FALLIDO
  PASSWORD_CAMBIADO
  PASSWORD_RESET_SOLICITADO
  PASSWORD_RESET_COMPLETADO
  TWO_FACTOR_HABILITADO
  TWO_FACTOR_DESHABILITADO
  SESION_REVOCADA

  // Perfil de usuario
  REGISTRO
  PERFIL_ACTUALIZADO
  EMAIL_CAMBIADO
  TELEFONO_CAMBIADO
  DOCUMENTO_CAMBIADO

  // PILA
  PILA_LIQUIDADA
  PILA_PAGADA
  COMPROBANTE_DESCARGADO
  CONFIGURACION_PILA_ACTUALIZADA

  // Facturación
  FACTURA_CREADA
  FACTURA_EMITIDA
  FACTURA_ANULADA
  FACTURA_DESCARGADA
  FACTURA_ENVIADA_EMAIL
  CLIENTE_CREADO
  CLIENTE_ACTUALIZADO
  CLIENTE_ELIMINADO

  // IA y Asesoría
  CONSULTA_IA
  CONVERSACION_CREADA
  CONVERSACION_ELIMINADA

  // Exportación y Privacidad
  DATOS_EXPORTADOS
  SOLICITUD_ELIMINACION
  CUENTA_ELIMINADA
  CONSENTIMIENTO_OTORGADO
  CONSENTIMIENTO_REVOCADO

  // Administración
  USUARIO_BLOQUEADO
  USUARIO_DESBLOQUEADO
  ROL_ASIGNADO
  CONFIGURACION_SISTEMA_CAMBIADA
  LOG_REVISADO
  ALERTA_GESTIONADA

  // Archivos
  ARCHIVO_SUBIDO
  ARCHIVO_DESCARGADO
  ARCHIVO_ELIMINADO

  // Seguridad
  INTENTO_ACCESO_NO_AUTORIZADO
  ACCESO_RECURSO_DENEGADO
  ACTIVIDAD_SOSPECHOSA_DETECTADA
  IP_BLOQUEADA

  // Sistema
  ERROR_SISTEMA
  BACKUP_REALIZADO
  MIGRACION_EJECUTADA
}

enum CategoriaAuditoria {
  AUTENTICACION
  AUTORIZACION
  DATOS_PERSONALES
  DATOS_FINANCIEROS
  FACTURACION
  SEGURIDAD_SOCIAL
  INTELIGENCIA_ARTIFICIAL
  ARCHIVOS
  ADMINISTRACION
  SEGURIDAD
  SISTEMA
  GENERAL
}

enum NivelRiesgo {
  BAJO
  MEDIO
  ALTO
  CRITICO
}

enum TipoAlerta {
  MULTIPLES_INTENTOS_FALLIDOS
  ACCESO_UBICACION_INUSUAL
  ACCESO_DISPOSITIVO_NUEVO
  CAMBIOS_MULTIPLES_RAPIDOS
  ACCESO_HORARIO_INUSUAL
  DESCARGA_MASIVA_DATOS
  INTENTOS_ACCESO_NO_AUTORIZADO
  PATRON_ACTIVIDAD_SOSPECHOSA
  POSIBLE_CUENTA_COMPROMETIDA
  ACTIVIDAD_ADMINISTRATIVA_INUSUAL
}

enum SeveridadAlerta {
  INFO
  BAJA
  MEDIA
  ALTA
  CRITICA
}

enum EstadoAlerta {
  PENDIENTE
  EN_REVISION
  FALSO_POSITIVO
  CONFIRMADA
  RESUELTA
  ARCHIVADA
}
